<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>
			bomberman
		</title>
		<link rel="stylesheet" href="">
		<script src='prototype.js'>
				
		</script>
	</head>
	<body>
		<canvas width='1000' height='500'>
		</canvas>
		<script type="text/javascript">
			var Obj = Class.create();
			Obj.prototype = {
				position: {
					x: 0,
					y: 0
				},
				destroyable: -1,
				initialize: function() {}
			}

			var Map = Class.create({
				sizeX: 20,
				sizeY: 20,
				objList: [],
			});

			var Player = Class.create(Obj, {
				destroyable: 1,
				bombLimit: 2,
				bombPlained: [],
				bombRange: 3
			});

			var Bomb = Class.create(Obj, {
				initialize: function(opts) {
					this.owner = opts.owner;
					this.position = Object.clone(this.owner.position);
					var self = this;
					setTimeout(function () {
						self.explode(self)
					}, this.timer);
				},
				destroyable: 1,
				owner: {},
				timer: 3000
			});

			var Block = Class.create(Obj, {
				destroyable: 1
			});

			var BlockSeparator = Class.create(Block, {
				destroyable: 0
			});


			Map.prototype.createObj = function (opts) {
				var obj;
				switch(opts.type) {
					case 'player':
						obj = new Player(opts);
						break;
					case 'bomb': 
						obj = new Bomb(opts);
						break;
					case 'sepBlock':
						obj = new BlockSeparator(opts);
						break;
					default:
						obj = new Obj(opts);
				}
				obj.map = this;
				return obj;	
			}

			Player.prototype.plainBomb = function() {



				if (this.bombPlained.length !== this.bombLimit) {

					var bomb = this.map.createObj({
						type:'bomb',
						owner: this
					});

					this.bombPlained.push(bomb);
				}

				console.log('bomb is plained');
				console.log('bombs list:');
				console.log(this.bombPlained);
			};
			Player.prototype.move = function(x, y) {
				this.position.x = x;
				this.position.y = y;
			}


			Bomb.prototype.explode = function(self) {
				var player = self.owner;

				console.log('booom!');
/*
				for (var i = 0; i < player.bombRange + 1; i++) {
					if (position.x - i)
				}*/



				console.log('bomb exploded');

				// recalculate bombs count after exploding
				player.bombPlained.remove(player.bombPlained.indexOf(self), player.bombPlained.indexOf(self));
				console.log(player.bombPlained);
			}


			var map = new Map();
			var p = map.createObj({
				type:'player',
				position: {
					x:5,
					y:5
				}
				});
			p.plainBomb();


			Array.prototype.remove = function(from, to) {
				var rest = this.slice((to || from) + 1 || this.length);
				this.length = from < 0 ? this.length + from : from;
				return this.push.apply(this, rest);
			};
		</script>
	</body>

</html>